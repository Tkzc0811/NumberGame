<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ¥æ•°æ¸¸æˆAi æŒ‘æˆ˜èµ›</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #e74c3c;
            --bg-color: #f5f7fa;
            --card-bg: white;
            --border-radius: 12px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            max-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* é˜²æ­¢å¤–å±‚æ»šåŠ¨ */
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            margin: 20px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 90vh; /* é™åˆ¶é«˜åº¦ä¸ºè§†å£é«˜åº¦çš„90% */
        }
        
        .header {
            background: linear-gradient(to right, var(--primary-color), #5a7dc9);
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            flex-shrink: 0; /* ä¸ç¼©å° */
        }
        
        .game-content {
            padding: 20px;
            overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        /* è§’è‰²é€‰æ‹©åŒºåŸŸ */
        .role-selection {
            text-align: center;
            padding: 20px 0;
        }
        
        .role-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .role-btn {
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            padding: 20px;
            width: 160px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .role-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .user-role:hover {
            border-color: var(--primary-color);
        }
        
        .robot-role:hover {
            border-color: var(--secondary-color);
        }
        
        .role-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        
        .role-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        /* æ¸¸æˆè§„åˆ™åŒºåŸŸ */
        .game-rules {
            background-color: #fff8e1;
            border-radius: var(--border-radius);
            padding: 15px;
            margin: 20px 0;
        }
        
        /* æ¸¸æˆåŒºåŸŸ */
        .game-area {
            display: none;
        }
        
        /* åˆ†æ•°æ˜¾ç¤º */
        .score-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .score-card {
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 15px;
            width: 48%;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .score-label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .score-value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .current-sum .score-value {
            color: var(--primary-color);
        }
        
        .target-sum .score-value {
            color: var(--secondary-color);
        }
        
        /* ç©å®¶åŒºåŸŸ */
        .players-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
        }
        
        .player {
            width: 40%;
            text-align: center;
        }
        
        .player-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px;
        }
        
        .user-player .player-avatar {
            background-color: rgba(74, 144, 226, 0.1);
            border: 3px solid var(--primary-color);
        }
        
        .ai-player .player-avatar {
            background-color: rgba(231, 76, 60, 0.1);
            border: 3px solid var(--secondary-color);
        }
        
        .player-name {
            font-weight: bold;
        }
        
        .vs-label {
            font-size: 24px;
            font-weight: bold;
            color: #6c757d;
        }
        
        .player.active .player-avatar {
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* çŠ¶æ€æ˜¾ç¤º */
        .status-area {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            border-radius: var(--border-radius);
            font-weight: bold;
        }
        
        .user-turn {
            background-color: rgba(74, 144, 226, 0.1);
            color: var(--primary-color);
        }
        
        .robot-turn {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--secondary-color);
        }
        
        /* æŒ‰é’®åŒºåŸŸ */
        .controls-area {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .btn-number {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }
        
        .btn-number:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-number:nth-child(1) {
            background-color: var(--primary-color);
        }
        
        .btn-number:nth-child(2) {
            background-color: var(--secondary-color);
        }
        
        /* å†å²è®°å½•åŒºåŸŸ */
        .history-area {
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 20px;
            height: 300px; /* å›ºå®šé«˜åº¦ */
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .history-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e9ecef;
            flex-shrink: 0; /* é˜²æ­¢æ ‡é¢˜è¢«å‹ç¼© */
        }
        
        .history-list-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px; /* ä¸ºæ»šåŠ¨æ¡é¢„ç•™ç©ºé—´ */
        }
        
        /* ç¾åŒ–å†å²è®°å½•é¡¹ç›® */
        .history-item {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* èƒœåˆ©å±å¹• */
        .victory-screen {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .trophy {
            font-size: 60px;
            margin: 20px 0;
        }
        
        .victory-message {
            font-size: 24px;
            font-weight: bold;
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 20px 0;
        }
        
        .user-wins {
            background-color: rgba(74, 144, 226, 0.1);
            color: var(--primary-color);
        }
        
        .robot-wins {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--secondary-color);
        }
        
        .btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        .number-animation {
            position: fixed;
            font-size: 80px;
            font-weight: bold;
            z-index: 100;
            opacity: 0;
            transform: translateY(0) scale(0.5);
            animation: numberPop 1.2s ease-out forwards;
            text-shadow: 0 0 10px rgba(0,0,0,0.3);
            pointer-events: none;
        }
        
        .user-number {
            color: var(--primary-color);
        }
        
        .robot-number {
            color: var(--secondary-color);
        }
        
        @keyframes numberPop {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.5);
            }
            20% {
                opacity: 1;
                transform: translateY(-30px) scale(1.5);
            }
            80% {
                opacity: 1;
                transform: translateY(-80px) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.7);
            }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 576px) {
            .container {
                margin: 10px;
            }
            
            .header {
                font-size: 1.2rem;
                padding: 10px;
            }
            
            .role-options {
                flex-direction: column;
                align-items: center;
            }
            
            .role-btn {
                width: 80%;
                margin-bottom: 10px;
            }
            
            .btn-number {
                width: 60px;
                height: 60px;
                font-size: 20px;
            }
            
            .player-avatar {
                width: 60px;
                height: 60px;
                font-size: 28px;
            }
            
            .score-value {
                font-size: 2rem;
            }
        }
        
        /* PCä¼˜åŒ– */
        @media (min-width: 992px) {
            .container {
                display: flex;
                flex-direction: column;
            }
            
            .game-content {
                display: flex;
                flex-direction: column;
                flex-grow: 1;
            }
            
            .main-game-area {
                display: flex;
                gap: 20px;
                margin-bottom: 20px;
            }
            
            .left-column {
                flex: 1;
                display: flex;
                flex-direction: column;
            }
            
            .right-column {
                flex: 1;
                display: flex;
                flex-direction: column;
            }
            
            .history-area {
                height: 350px; /* PCç«¯æ›´é«˜ä¸€äº› */
            }
        }
        
        /* åˆ›å»ºå·¦å³åˆ—å¸ƒå±€ */
        .main-game-area {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            flex: 1;
            overflow: hidden;
        }
        
        .left-column {
            flex: 1;
            min-width: 250px;
            padding-right: 10px;
            display: flex;
            flex-direction: column;
        }
        
        .right-column {
            flex: 1;
            min-width: 250px;
            padding-left: 10px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* ç¡®ä¿èƒœåˆ©æ¨¡æ€æ¡†ä¸­çš„å†å²è®°å½•ä¹Ÿæœ‰å›ºå®šé«˜åº¦ */
        .victory-history {
            max-height: 200px;
            margin: 15px 0;
            display: flex;
            flex-direction: column;
        }
        
        .victory-history .history-list-container {
            height: 150px; /* å›ºå®šé«˜åº¦ */
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 5px;
            background-color: white;
        }
        
        /* æ‰‹æœºç«¯ä¼˜åŒ– */
        @media (max-width: 767px) {
            .history-area {
                height: 250px; /* ç§»åŠ¨ç«¯ç¨çŸ®ä¸€äº› */
            }
        }
        
        /* ä¿®å¤æ¨¡æ€æ¡†æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }
        
        .prompt-text {
            font-size: 16px;
            color: #555;
            margin: 15px 0;
            font-weight: 500;
        }
        
        /* æŒ‰é’®æ ·å¼ä¼˜åŒ– */
        .victory-buttons {
            margin-top: 25px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
        }
        
        .btn-secondary {
            background-color: #6c757d;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        /* ä¿®å¤èƒœåˆ©æ¨¡æ€æ¡†æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }
        
        .victory-screen {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            transform: translateY(20px);
            transition: all 0.3s ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal-overlay.active .victory-screen {
            transform: translateY(0);
        }
        
        /* æ¢å¤å†å²è®°å½•é¡¹æ ·å¼ */
        .history-item {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            border-radius: 8px;
            margin-bottom: 8px;
            animation: fadeIn 0.3s ease-out;
        }
        
        .move-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .move-text {
            flex: 1;
        }
        
        .user-move .move-number {
            background-color: var(--primary-color);
        }
        
        .robot-move .move-number {
            background-color: var(--secondary-color);
        }
        
        .user-move {
            background-color: rgba(74, 144, 226, 0.08);
            border-left: 4px solid var(--primary-color);
        }
        
        .robot-move {
            background-color: rgba(231, 76, 60, 0.08);
            border-left: 4px solid var(--secondary-color);
        }
        
        /* æ•°å­—åŠ¨ç”»æ ·å¼ */
        .number-animation {
            position: fixed;
            font-size: 80px;
            font-weight: bold;
            z-index: 100;
            opacity: 0;
            transform: translateY(0) scale(0.5);
            animation: numberPop 1.2s ease-out forwards;
            text-shadow: 0 0 10px rgba(0,0,0,0.3);
            pointer-events: none;
        }
        
        @keyframes numberPop {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.5);
            }
            20% {
                opacity: 1;
                transform: translateY(-30px) scale(1.5);
            }
            80% {
                opacity: 1;
                transform: translateY(-80px) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.7);
            }
        }
        
        .user-number {
            color: var(--primary-color);
        }
        
        .robot-number {
            color: var(--secondary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="back-btn">&#8249;</div>
            <div class="header-title">äººæœºå¯¹æˆ˜</div>
        </div>
        
        <div class="game-content">
            <!-- è§’è‰²é€‰æ‹©åŒºåŸŸ -->
            <div id="roleSelection" class="role-selection">
                <h2>è°å…ˆå¼€å§‹ï¼Ÿ</h2>
                <div class="role-options">
                    <div id="userFirst" class="role-btn user-role">
                        <div class="role-icon">ğŸ‘¤</div>
                        <div class="role-name">ç”¨æˆ·å…ˆæ‰‹</div>
                        <div class="first-player">ä½ å¼€å§‹æ¸¸æˆ</div>
                    </div>
                    <div id="robotFirst" class="role-btn robot-role">
                        <div class="role-icon">ğŸ¤–</div>
                        <div class="role-name">AIå…ˆæ‰‹</div>
                        <div class="first-player">AIå¼€å§‹æ¸¸æˆ</div>
                    </div>
                </div>
                
                <div class="game-rules">
                    <strong>æ¸¸æˆè§„åˆ™ï¼š</strong>
                    <ul>
                        <li>ç©å®¶è½®æµç»™æ€»å’ŒåŠ 1æˆ–2</li>
                        <li>å½“æ€»å’Œè¾¾åˆ°<span>10æˆ–æ›´é«˜</span>æ—¶æ¸¸æˆç»“æŸ</li>
                    </ul>
                </div>
            </div>
            
            <!-- æ¸¸æˆåŒºåŸŸ -->
            <div id="gameArea" class="game-area">
                <div class="score-display">
                    <div class="score-card current-sum">
                        <div class="score-label">å½“å‰æ€»å’Œ:</div>
                        <div id="result" class="score-value">0</div>
                    </div>
                    <div class="score-card target-sum">
                        <div class="score-label">ç›®æ ‡å€¼:</div>
                        <div class="score-value">10</div>
                    </div>
                </div>
                
                <div class="main-game-area">
                    <div class="left-column">
                        <!-- ç©å®¶åŒºåŸŸ -->
                        <div class="players-area">
                            <div id="userIndicator" class="player user-player">
                                <div class="player-avatar">ğŸ‘¤</div>
                                <div class="player-name">ç”¨æˆ·</div>
                            </div>
                            <div class="vs-label">VS</div>
                            <div id="robotIndicator" class="player ai-player">
                                <div class="player-avatar">ğŸ¤–</div>
                                <div class="player-name">AI</div>
                            </div>
                        </div>
                        
                        <!-- çŠ¶æ€åŒºåŸŸ -->
                        <div id="status" class="status-area">æ¸¸æˆå¼€å§‹...</div>
                        
                        <!-- æ§åˆ¶åŒºåŸŸ -->
                        <div id="userControls" class="controls-area">
                            <button id="btn1" class="btn-number">1</button>
                            <button id="btn2" class="btn-number">2</button>
                        </div>
                    </div>
                    
                    <div class="right-column">
                        <!-- å†å²è®°å½•åŒºåŸŸ -->
                        <div class="history-area">
                            <div class="history-title">å†å²è®°å½•</div>
                            <div class="history-list-container">
                                <div id="historyList"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- èƒœåˆ©æ¨¡æ€æ¡† -->
    <div id="victoryModal" class="modal-overlay">
        <div id="victoryScreen" class="victory-screen">
            <div class="trophy">ğŸ†</div>
            <div id="victoryMessage" class="victory-message">èƒœåˆ©ï¼</div>
            <div id="finalResult" class="score-value">æ€»å’Œ: 12</div>
            
            <div class="prompt-text">æ­å–œä½ å®Œæˆäº†è¿™ä¸€å±€ï¼æƒ³æŒ‘æˆ˜è‡ªå·±å—ï¼Ÿ</div>
            
            <div class="victory-history">
                <div class="history-title">æ¸¸æˆå†å²</div>
                <div id="moveCount" class="move-count">æ€»æ­¥æ•°: 0</div>
                <div class="history-list-container">
                    <div id="victoryHistoryList"></div>
                </div>
            </div>
            
            <div class="victory-buttons">
                <button id="playAgain" class="btn btn-primary">å†ç©ä¸€æ¬¡</button>
                <button id="exitGame" class="btn btn-secondary">é€€å‡ºæ¸¸æˆ</button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆå˜é‡
        let sum = 0;
        let isUserTurn = true;
        let firstPlayer = ''; // 'user' or 'robot'
        const targetSum = 10; // ç»“æŸæ¸¸æˆçš„æœ€å°æ€»å’Œ
        let gameHistory = []; // å­˜å‚¨æ‰€æœ‰ç§»åŠ¨
        
        // DOMå…ƒç´ 
        const roleSelection = document.getElementById('roleSelection');
        const gameArea = document.getElementById('gameArea');
        const victoryScreen = document.getElementById('victoryScreen');
        const victoryMessage = document.getElementById('victoryMessage');
        const finalResult = document.getElementById('finalResult');
        const status = document.getElementById('status');
        const result = document.getElementById('result');
        const userControls = document.getElementById('userControls');
        const btn1 = document.getElementById('btn1');
        const btn2 = document.getElementById('btn2');
        const historyList = document.getElementById('historyList');
        const victoryHistoryList = document.getElementById('victoryHistoryList');
        const moveCount = document.getElementById('moveCount');
        const playAgain = document.getElementById('playAgain');
        const userIndicator = document.getElementById('userIndicator');
        const robotIndicator = document.getElementById('robotIndicator');
        const victoryModal = document.getElementById('victoryModal');
        const exitGame = document.getElementById('exitGame');
        
        // è§’è‰²é€‰æ‹©
        document.getElementById('userFirst').addEventListener('click', () => {
            firstPlayer = 'user';
            startGame();
        });
        
        document.getElementById('robotFirst').addEventListener('click', () => {
            firstPlayer = 'robot';
            startGame();
        });
        
        // å†ç©ä¸€æ¬¡æŒ‰é’®
        playAgain.addEventListener('click', () => {
            resetGame();
            victoryModal.classList.remove('active');
            document.body.style.overflow = ''; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            roleSelection.style.display = 'block';
            gameArea.style.display = 'none';
        });
        
        // é€€å‡ºæ¸¸æˆæŒ‰é’®
        exitGame.addEventListener('click', () => {
            victoryModal.classList.remove('active');
            document.body.style.overflow = ''; // æ¢å¤èƒŒæ™¯æ»šåŠ¨
        });
        
        // ç¡®ä¿æ¨¡æ€æ¡†ä¹‹å¤–çš„ç‚¹å‡»ä¹Ÿèƒ½å…³é—­æ¨¡æ€æ¡†
        victoryModal.addEventListener('click', (e) => {
            if (e.target === victoryModal) {
                victoryModal.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            roleSelection.style.display = 'none';
            gameArea.style.display = 'block';
            
            // é‡ç½®æ¸¸æˆå†å²
            gameHistory = [];
            
            // æ ¹æ®é€‰æ‹©è®¾ç½®è°å…ˆè¡ŒåŠ¨
            isUserTurn = (firstPlayer === 'user');
            
            updateTurnIndicators();
            
            // å¦‚æœæœºå™¨äººå…ˆè¡Œï¼Œè§¦å‘å…¶ç§»åŠ¨
            if (firstPlayer === 'robot') {
                setTimeout(robotMove, 1000);
            }
        }
        
        // æ›´æ–°å›åˆæŒ‡ç¤ºå™¨
        function updateTurnIndicators() {
            if (isUserTurn) {
                status.textContent = "ç”¨æˆ·å›åˆï¼é€‰æ‹©1æˆ–2ã€‚";
                status.className = "status-area user-turn";
                userIndicator.classList.add('active');
                robotIndicator.classList.remove('active');
                userControls.style.pointerEvents = 'auto';
            } else {
                status.textContent = "AIæ€è€ƒä¸­...";
                status.className = "status-area robot-turn";
                robotIndicator.classList.add('active');
                userIndicator.classList.remove('active');
                userControls.style.pointerEvents = 'none';
            }
        }
        
        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            sum = 0;
            isUserTurn = true;
            gameHistory = [];
            historyList.innerHTML = '';
            victoryHistoryList.innerHTML = '';
            result.textContent = '0';
        }
        
        // æ£€æŸ¥æ•°å­—æ˜¯å¦ä¸º3çš„å€æ•°
        function isMultipleOfThree(num) {
            return num % 3 === 0 && num !== 0; // æ’é™¤0ä½œä¸ºè·èƒœä½ç½®
        }
        
        // å¤„ç†ç”¨æˆ·çš„ç§»åŠ¨
        btn1.addEventListener('click', () => makeMove(1, true));
        btn2.addEventListener('click', () => makeMove(2, true));
        
        // è¿›è¡Œç§»åŠ¨
        function makeMove(number, isHuman) {
            // åªå…è®¸åœ¨ç”¨æˆ·å›åˆè¿›è¡Œäººç±»ç§»åŠ¨
            if (isHuman && !isUserTurn) {
                return;
            }
            
            sum += number;
            
            // æ˜¾ç¤ºæ•°å­—åŠ¨ç”»
            showNumberAnimation(number, isHuman);
            
            // æ›´æ–°UI
            result.textContent = `${sum}`;
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            const player = isHuman ? 'ç”¨æˆ·' : 'AI';
            const moveText = `${player} æ·»åŠ äº† ${number}ã€‚æ€»å’Œ: ${sum}`;
            
            // å­˜å‚¨åˆ°æ¸¸æˆå†å²æ•°ç»„
            gameHistory.push({
                player: player,
                number: number,
                sum: sum,
                text: `æ·»åŠ äº† ${number}ã€‚æ€»å’Œ: ${sum}`
            });
            
            // æ·»åŠ åˆ°å†å²æ˜¾ç¤º
            const historyItem = document.createElement('div');
            historyItem.className = `history-item ${isHuman ? 'user-move' : 'robot-move'}`;
            
            const moveNumber = document.createElement('div');
            moveNumber.className = 'move-number';
            moveNumber.textContent = number;
            
            const moveTextElem = document.createElement('div');
            moveTextElem.className = 'move-text';
            moveTextElem.textContent = `${player} æ·»åŠ äº† ${number}ã€‚æ€»å’Œ: ${sum}`;
            
            historyItem.appendChild(moveNumber);
            historyItem.appendChild(moveTextElem);
            historyList.appendChild(historyItem);
            
            // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
            document.querySelector('.history-list-container').scrollTop = 
                document.querySelector('.history-list-container').scrollHeight;
            
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦åº”è¯¥ç»“æŸ (sum â‰¥ 10)
            if (sum >= targetSum) {
                // æ ¹æ®æœ€ç»ˆæ€»å’Œæ˜¯å¦ä¸º3çš„å€æ•°ç¡®å®šè·èƒœè€…
                if (isMultipleOfThree(sum)) {
                    // å¦‚æœæ€»å’Œæ˜¯3çš„å€æ•°ï¼Œå½“å‰ç©å®¶è·èƒœ
                    showVictory(player);
                } else {
                    // å¦‚æœæ€»å’Œä¸æ˜¯3çš„å€æ•°ï¼Œå½“å‰ç©å®¶å¤±è´¥
                    const winner = player === 'ç”¨æˆ·' ? 'AI' : 'ç”¨æˆ·';
                    showVictory(winner);
                }
                return;
            }
            
            // åˆ‡æ¢å›åˆ
            isUserTurn = !isUserTurn;
            
            // æ›´æ–°å›åˆæŒ‡ç¤ºå™¨
            updateTurnIndicators();
            
            // å¦‚æœæ˜¯æœºå™¨äººçš„å›åˆï¼Œè§¦å‘å…¶ç§»åŠ¨
            if (!isUserTurn) {
                setTimeout(robotMove, 1000);
            }
        }
        
        // æœºå™¨äººçš„ç§»åŠ¨
        function robotMove() {
            // ç­–ç•¥: 
            // 1. å¦‚æœå¯ä»¥ä½¿æ€»å’Œ â‰¥ 10 ä¸”ä¸º 3 çš„å€æ•°ï¼Œèµ¢å¾—æ¸¸æˆ
            // 2. å¦‚æœæ€»å’Œä¼š â‰¥ 10 ä½†ä¸æ˜¯ 3 çš„å€æ•°ï¼Œå°½å¯èƒ½é¿å…
            // 3. å¦åˆ™ï¼Œéµå¾ªé€šç”¨å®šä½ç­–ç•¥
            let choice;
            
            // æ£€æŸ¥æœºå™¨äººæ˜¯å¦å¯ä»¥é€šè¿‡ä½¿æ€»å’Œ â‰¥ 10 ä¸”ä¸º 3 çš„å€æ•°è·èƒœ
            if (sum + 1 >= targetSum && isMultipleOfThree(sum + 1)) {
                choice = 1; // åŠ 1è·èƒœ
            } else if (sum + 2 >= targetSum && isMultipleOfThree(sum + 2)) {
                choice = 2; // åŠ 2è·èƒœ
            } 
            // æ£€æŸ¥æœºå™¨äººæ˜¯å¦ä¼šé€šè¿‡ä½¿æ€»å’Œ â‰¥ 10 ä½†ä¸æ˜¯ 3 çš„å€æ•°è€Œå¤±è´¥
            else if (sum + 1 >= targetSum && !isMultipleOfThree(sum + 1) && 
                     sum + 2 >= targetSum && !isMultipleOfThree(sum + 2)) {
                // ä¸¤ç§ç§»åŠ¨éƒ½ä¼šå¤±è´¥ï¼Œéšæœºé€‰æ‹©
                choice = Math.random() < 0.5 ? 1 : 2;
            }
            else if (sum + 1 >= targetSum && !isMultipleOfThree(sum + 1)) {
                // åŠ 1ä¼šå¤±è´¥ï¼Œæ‰€ä»¥åŠ 2
                choice = 2;
            }
            else if (sum + 2 >= targetSum && !isMultipleOfThree(sum + 2)) {
                // åŠ 2ä¼šå¤±è´¥ï¼Œæ‰€ä»¥åŠ 1
                choice = 1;
            }
            // æ¸¸æˆæ—©æœŸçš„é€šç”¨ç­–ç•¥
            else {
                // å°è¯•é€šè¿‡æˆ˜ç•¥ç§»åŠ¨ä¸ºæœªæ¥è·èƒœåšå‡†å¤‡
                if ((sum + 1) % 3 === 0) {
                    choice = 1; // åŠ 1ä½¿æ€»å’Œæˆä¸º3çš„å€æ•°
                } else if ((sum + 2) % 3 === 0) {
                    choice = 2; // åŠ 2ä½¿æ€»å’Œæˆä¸º3çš„å€æ•°
                } else {
                    // ä¸èƒ½ç›´æ¥å½¢æˆ3çš„å€æ•°
                    const remainder = sum % 3;
                    if (remainder === 1) {
                        choice = 2;
                    } else if (remainder === 2) {
                        choice = 1;
                    } else {
                        // è¿™åœ¨æ­£ç¡®çš„æ¸¸æˆé€»è¾‘ä¸‹ä¸åº”è¯¥å‘ç”Ÿ
                        choice = Math.random() < 0.5 ? 1 : 2;
                    }
                }
            }
            
            makeMove(choice, false);
        }
        
        // æ˜¾ç¤ºèƒœåˆ©ç”»é¢
        function showVictory(winner) {
            // æ¸…é™¤èƒœåˆ©å†å²åˆ—è¡¨
            victoryHistoryList.innerHTML = '';
            
            // æ›´æ–°ç§»åŠ¨è®¡æ•°
            moveCount.textContent = `æ€»æ­¥æ•°: ${gameHistory.length}`;
            
            // ä»å­˜å‚¨çš„æ•°ç»„é‡å»ºå®Œæ•´å†å²
            gameHistory.forEach(move => {
                const historyItem = document.createElement('div');
                historyItem.className = `history-item ${move.player === 'ç”¨æˆ·' ? 'user-move' : 'robot-move'}`;
                
                const moveNumber = document.createElement('div');
                moveNumber.className = 'move-number';
                moveNumber.textContent = move.number;
                
                const moveText = document.createElement('div');
                moveText.className = 'move-text';
                moveText.textContent = `${move.player} ${move.text}`;
                
                historyItem.appendChild(moveNumber);
                historyItem.appendChild(moveText);
                victoryHistoryList.appendChild(historyItem);
            });
            
            // æ›´æ–°èƒœåˆ©ä¿¡æ¯
            finalResult.textContent = `æœ€ç»ˆæ€»å’Œ: ${sum}`;
            
            if (winner === 'ç”¨æˆ·') {
                victoryMessage.textContent = 'ğŸ‘¤ ç”¨æˆ·è·èƒœï¼ğŸ‰';
                victoryMessage.className = 'victory-message user-wins';
            } else {
                victoryMessage.textContent = 'ğŸ¤– AIè·èƒœï¼ğŸ‰';
                victoryMessage.className = 'victory-message robot-wins';
            }
            
            // ç¡®ä¿æ˜¾ç¤ºæç¤ºæ–‡æœ¬
            document.querySelector('.prompt-text').style.display = 'block';
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            victoryModal.classList.add('active');
            document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            
            // åˆ›å»ºå½©å¸¦æ•ˆæœ
            createConfetti();
        }
        
        // æ˜¾ç¤ºæ•°å­—åŠ¨ç”»
        function showNumberAnimation(number, isHuman) {
            const animatedNumber = document.createElement('div');
            animatedNumber.className = `number-animation ${isHuman ? 'user-number' : 'robot-number'}`;
            animatedNumber.textContent = `+${number}`;
            
            // è®¡ç®—ä½ç½® - ä»å½“å‰ç©å®¶çš„åŒºåŸŸä¸­å¿ƒå¼€å§‹
            const playerIndicator = isHuman ? userIndicator : robotIndicator;
            const rect = playerIndicator.getBoundingClientRect();
            const startX = rect.left + rect.width / 2;
            const startY = rect.top + rect.height / 2;
            
            // è®¾ç½®ä½ç½®å¹¶ç¡®ä¿å¯è§
            animatedNumber.style.left = `${startX}px`;
            animatedNumber.style.top = `${startY}px`;
            
            document.body.appendChild(animatedNumber);
            
            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => {
                if (animatedNumber && animatedNumber.parentNode) {
                    animatedNumber.parentNode.removeChild(animatedNumber);
                }
            }, 1500);
        }
        
        // åˆ›å»ºå½©å¸¦æ•ˆæœ
        function createConfetti() {
            const colors = ['#f00', '#0f0', '#00f', '#ff0', '#0ff', '#f0f'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
                document.body.appendChild(confetti);
                
                // åŠ¨ç”»åç§»é™¤å½©å¸¦
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }
        
        // ç¡®ä¿confettiæ ·å¼å­˜åœ¨
        const style = document.createElement('style');
        style.textContent = `
            .confetti {
                position: fixed;
                width: 10px;
                height: 10px;
                top: -10px;
                border-radius: 0%;
                animation: fall 5s linear forwards;
            }
            @keyframes fall {
                to { transform: translateY(100vh) rotate(720deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
